cmake_minimum_required(VERSION 3.19)
project(aqlm)

set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED True)

include(/Users/blacksamorez/reps/executorch/build/Utils.cmake)
include(/Users/blacksamorez/reps/executorch/build/Codegen.cmake)

add_library(aqlm SHARED
    ./lut_kernel.cpp
    ./lut_kernel.h)

target_include_directories(
    aqlm
    PRIVATE
    /Users/blacksamorez/reps
)

target_link_libraries(
    aqlm
    PRIVATE
    executorch_no_prim_ops
    cpublas)


if (EXECUTORCH_BUILD_KERNELS_CUSTOM_AOT)
    find_package(Torch REQUIRED)
    find_library(
        TORCH_PYTHON_LIBRARY torch_python PATHS "${TORCH_INSTALL_PREFIX}/lib"
    )

    add_library(aqlm_bindings SHARED
        ./lut_kernel_pytorch.cpp)

    target_include_directories(
        aqlm_bindings
        PRIVATE
        /opt/miniconda3/envs/executorch/include/python3.10
        /Users/blacksamorez/reps
    )
    
    target_link_libraries(
        aqlm_bindings
        PRIVATE
        aqlm
        torch
        executorch
    )
endif()