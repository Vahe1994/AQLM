cmake_minimum_required(VERSION 3.19)
project(aqlm)

set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED True)

find_package(Torch REQUIRED)
find_library(
    TORCH_PYTHON_LIBRARY torch_python PATHS "${TORCH_INSTALL_PREFIX}/lib"
)

option(EXECUTORCH_BUILD_KERNELS_OPTIMIZED "" ON)

# Include the executorch subdirectory.
add_subdirectory(
    /Users/blacksamorez/reps/executorch
    ${CMAKE_BINARY_DIR}/../executorch)

add_library(aqlm SHARED
    ./lut_kernel_pytorch.cpp
    ./lut_kernel.cpp
    ./lut_kernel.h)

target_include_directories(
    aqlm
    PRIVATE
    /opt/miniconda3/envs/executorch/include/python3.10
    /Users/blacksamorez/reps
)

target_link_libraries(
    aqlm
    PRIVATE
    torch
    executorch
    cpublas)
